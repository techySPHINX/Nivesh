# Nivesh Backend - Technical Architecture

## ğŸ—ï¸ System Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          CLIENT APPLICATIONS                            â”‚
â”‚                                                                          â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚    â”‚   Web App    â”‚    â”‚  Mobile App  â”‚    â”‚  API Clients â”‚          â”‚
â”‚    â”‚  (Next.js)   â”‚    â”‚(React Native)â”‚    â”‚  (External)  â”‚          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                    â”‚                    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           API GATEWAY                                    â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  NestJS Application (Port 3000)                                  â”‚  â”‚
â”‚  â”‚  â€¢ REST API (Express)                                            â”‚  â”‚
â”‚  â”‚  â€¢ Swagger/OpenAPI Documentation                                 â”‚  â”‚
â”‚  â”‚  â€¢ API Versioning (v1)                                          â”‚  â”‚
â”‚  â”‚  â€¢ Rate Limiting (100 req/min)                                  â”‚  â”‚
â”‚  â”‚  â€¢ CORS Configuration                                           â”‚  â”‚
â”‚  â”‚  â€¢ Helmet Security Headers                                      â”‚  â”‚
â”‚  â”‚  â€¢ Compression                                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SECURITY LAYER                                    â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚ Authentication       â”‚  â”‚ Encryption Services â”‚                     â”‚
â”‚  â”‚ â€¢ JWT Strategy       â”‚  â”‚ â€¢ AES-256-GCM       â”‚                     â”‚
â”‚  â”‚ â€¢ Firebase Strategy  â”‚  â”‚ â€¢ Bcrypt Hashing    â”‚                     â”‚
â”‚  â”‚ â€¢ Passport Guards    â”‚  â”‚ â€¢ SHA-256           â”‚                     â”‚
â”‚  â”‚ â€¢ Token Refresh      â”‚  â”‚ â€¢ Key Management    â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     APPLICATION LAYER (Modules)                          â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   User   â”‚  â”‚Financial â”‚  â”‚Knowledge â”‚  â”‚    AI    â”‚  â”‚ Goals  â”‚  â”‚
â”‚  â”‚Managementâ”‚  â”‚   Data   â”‚  â”‚  Graph   â”‚  â”‚Reasoning â”‚  â”‚Planningâ”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â”‚
â”‚       â”‚             â”‚             â”‚             â”‚             â”‚        â”‚
â”‚  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Event Bus (Kafka Integration)                      â”‚  â”‚
â”‚  â”‚  â€¢ Domain Events                                                â”‚  â”‚
â”‚  â”‚  â€¢ Async Communication                                          â”‚  â”‚
â”‚  â”‚  â€¢ Event Sourcing                                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    INFRASTRUCTURE LAYER                                  â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚  Database Cluster    â”‚  â”‚  Messaging System    â”‚                   â”‚
â”‚  â”‚                      â”‚  â”‚                      â”‚                   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                   â”‚
â”‚  â”‚ â”‚  PostgreSQL    â”‚  â”‚  â”‚ â”‚     Kafka      â”‚  â”‚                   â”‚
â”‚  â”‚ â”‚  Port: 5432    â”‚  â”‚  â”‚ â”‚  Port: 29092   â”‚  â”‚                   â”‚
â”‚  â”‚ â”‚  â€¢ Prisma ORM  â”‚  â”‚  â”‚ â”‚  â€¢ Producer    â”‚  â”‚                   â”‚
â”‚  â”‚ â”‚  â€¢ Transactionsâ”‚  â”‚  â”‚ â”‚  â€¢ Consumer    â”‚  â”‚                   â”‚
â”‚  â”‚ â”‚  â€¢ Accounts    â”‚  â”‚  â”‚ â”‚  â€¢ Topics      â”‚  â”‚                   â”‚
â”‚  â”‚ â”‚  â€¢ Users       â”‚  â”‚  â”‚ â”‚  â€¢ Groups      â”‚  â”‚                   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                   â”‚
â”‚  â”‚                      â”‚  â”‚                      â”‚                   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                   â”‚
â”‚  â”‚ â”‚     Neo4j      â”‚  â”‚  â”‚ â”‚   Zookeeper    â”‚  â”‚                   â”‚
â”‚  â”‚ â”‚  Port: 7687    â”‚  â”‚  â”‚ â”‚  Port: 2181    â”‚  â”‚                   â”‚
â”‚  â”‚ â”‚  â€¢ Graph DB    â”‚  â”‚  â”‚ â”‚  â€¢ Coordinator â”‚  â”‚                   â”‚
â”‚  â”‚ â”‚  â€¢ Cypher      â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                   â”‚
â”‚  â”‚ â”‚  â€¢ Entities    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚  â”‚ â”‚  â€¢ Relations   â”‚  â”‚                                              â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚                      â”‚  â”‚  Caching & Sessions  â”‚                   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚                      â”‚                   â”‚
â”‚  â”‚ â”‚    MongoDB     â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                   â”‚
â”‚  â”‚ â”‚  Port: 27017   â”‚  â”‚  â”‚ â”‚     Redis      â”‚  â”‚                   â”‚
â”‚  â”‚ â”‚  â€¢ Flexible    â”‚  â”‚  â”‚ â”‚  Port: 6379    â”‚  â”‚                   â”‚
â”‚  â”‚ â”‚  â€¢ Documents   â”‚  â”‚  â”‚ â”‚  â€¢ Cache       â”‚  â”‚                   â”‚
â”‚  â”‚ â”‚  â€¢ Chat logs   â”‚  â”‚  â”‚ â”‚  â€¢ Sessions    â”‚  â”‚                   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚ â”‚  â€¢ Pub/Sub     â”‚  â”‚                   â”‚
â”‚  â”‚                      â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚  â”‚ â”‚  ClickHouse    â”‚  â”‚                                              â”‚
â”‚  â”‚ â”‚  Port: 8123    â”‚  â”‚                                              â”‚
â”‚  â”‚ â”‚  â€¢ Analytics   â”‚  â”‚                                              â”‚
â”‚  â”‚ â”‚  â€¢ Time-series â”‚  â”‚                                              â”‚
â”‚  â”‚ â”‚  â€¢ OLAP        â”‚  â”‚                                              â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      OBSERVABILITY LAYER                                 â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚   Logging    â”‚  â”‚   Metrics    â”‚  â”‚   Tracing    â”‚                 â”‚
â”‚  â”‚  (Winston)   â”‚  â”‚(Prometheus)  â”‚  â”‚(OpenTelemetryâ”‚                 â”‚
â”‚  â”‚  â€¢ Structuredâ”‚  â”‚  â€¢ Ready     â”‚  â”‚  â€¢ Ready     â”‚                 â”‚
â”‚  â”‚  â€¢ Files     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚  â”‚  â€¢ Console   â”‚                                                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Data Flow Architecture

### 1. Request Flow (Synchronous)

```
Client Request
    â†“
API Gateway (NestJS)
    â†“
Security Layer (JWT/Firebase Auth)
    â†“
Rate Limiter
    â†“
Validation Pipeline
    â†“
Module Controller
    â†“
Application Service (Use Case)
    â†“
Domain Logic
    â†“
Repository Interface
    â†“
Infrastructure (DB)
    â†“
Response + Event Publication
```

### 2. Event Flow (Asynchronous)

```
Domain Event
    â†“
Kafka Producer
    â†“
Kafka Topic
    â†“
Kafka Consumer
    â†“
Event Handler
    â†“
Side Effects (Updates, Notifications, etc.)
```

### 3. Caching Strategy

```
Request
    â†“
Check Redis Cache
    â”œâ”€ Hit â†’ Return Cached Data
    â””â”€ Miss
        â†“
    Query Database
        â†“
    Store in Redis (TTL: 1 hour)
        â†“
    Return Data
```

## ğŸ”„ Module Architecture Pattern

Each module follows Clean Architecture:

```
module-name/
â”œâ”€â”€ domain/                          # Core business logic
â”‚   â”œâ”€â”€ entities/                    # Domain entities
â”‚   â”œâ”€â”€ value-objects/               # Immutable value objects
â”‚   â”œâ”€â”€ repositories/                # Repository interfaces
â”‚   â””â”€â”€ events/                      # Domain events
â”‚
â”œâ”€â”€ application/                     # Use cases
â”‚   â”œâ”€â”€ commands/                    # Write operations (CQRS)
â”‚   â”‚   â”œâ”€â”€ create-entity.command.ts
â”‚   â”‚   â””â”€â”€ handlers/
â”‚   â”œâ”€â”€ queries/                     # Read operations (CQRS)
â”‚   â”‚   â”œâ”€â”€ get-entity.query.ts
â”‚   â”‚   â””â”€â”€ handlers/
â”‚   â””â”€â”€ dto/                         # Data transfer objects
â”‚
â”œâ”€â”€ infrastructure/                  # External concerns
â”‚   â”œâ”€â”€ persistence/                 # DB implementation
â”‚   â”‚   â”œâ”€â”€ entity.repository.ts
â”‚   â”‚   â””â”€â”€ entity.schema.ts
â”‚   â””â”€â”€ integrations/                # External services
â”‚
â””â”€â”€ presentation/                    # API layer
    â”œâ”€â”€ controllers/                 # REST endpoints
    â””â”€â”€ dto/                         # API contracts
```

## ğŸ—„ï¸ Database Architecture

### PostgreSQL Schema

```
users
â”œâ”€â”€ id (UUID, PK)
â”œâ”€â”€ email (unique)
â”œâ”€â”€ firstName
â”œâ”€â”€ lastName
â””â”€â”€ kycStatus

accounts
â”œâ”€â”€ id (UUID, PK)
â”œâ”€â”€ userId (FK â†’ users)
â”œâ”€â”€ accountType
â”œâ”€â”€ currentBalance
â””â”€â”€ fiMcpAccountId

transactions
â”œâ”€â”€ id (UUID, PK)
â”œâ”€â”€ userId (FK â†’ users)
â”œâ”€â”€ accountId (FK â†’ accounts)
â”œâ”€â”€ amount
â”œâ”€â”€ type (credit/debit)
â””â”€â”€ category

goals
â”œâ”€â”€ id (UUID, PK)
â”œâ”€â”€ userId (FK â†’ users)
â”œâ”€â”€ goalType
â”œâ”€â”€ targetAmount
â””â”€â”€ targetDate
```

### Neo4j Graph Model

```
(User)-[:HAS_ACCOUNT]->(Account)
(User)-[:HAS_GOAL]->(Goal)
(Transaction)-[:BELONGS_TO]->(Account)
(Transaction)-[:CATEGORIZED_AS]->(Category)
(Goal)-[:REQUIRES]->(Investment)
(User)-[:SIMILAR_TO]->(User)
```

### MongoDB Collections

```
conversations: {
  userId: string,
  messages: [{
    role: 'user' | 'assistant',
    content: string,
    timestamp: Date
  }]
}

ai_sessions: {
  sessionId: string,
  context: object,
  history: []
}
```

### Redis Key Patterns

```
user:{userId}                    # User cache
session:{sessionId}              # Session data
ratelimit:{ip}:{endpoint}        # Rate limiting
cache:query:{hash}               # Query results
```

### ClickHouse Tables

```
events_log: Time-series event tracking
analytics_daily: Daily aggregations
user_metrics: User behavior metrics
```

## ğŸ” Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Security Layers                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Transport Security (HTTPS)           â”‚
â”‚ 2. Rate Limiting (100 req/min)          â”‚
â”‚ 3. CORS (Configured origins)            â”‚
â”‚ 4. Helmet (Security headers)            â”‚
â”‚ 5. JWT/Firebase Authentication          â”‚
â”‚ 6. Role-Based Access Control            â”‚
â”‚ 7. Data Encryption (AES-256-GCM)        â”‚
â”‚ 8. Password Hashing (Bcrypt)            â”‚
â”‚ 9. Input Validation (class-validator)   â”‚
â”‚ 10. SQL Injection Protection (Prisma)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ˆ Scalability Strategy

### Horizontal Scaling

- Stateless application servers
- Redis for session sharing
- Load balancer ready
- Database connection pooling

### Vertical Scaling

- Configurable connection pools
- Cache-aside pattern
- Async processing with Kafka
- Database query optimization

### Future Microservices Migration

```
Monolith â†’ Modular Monolith â†’ Microservices

Current modules can become independent services:
- User Service
- Financial Data Service
- AI Reasoning Service
- Knowledge Graph Service
- etc.
```

---

**Architecture Status**: âœ… Production-Ready Foundation  
**Next Phase**: Implement business modules on this architecture
